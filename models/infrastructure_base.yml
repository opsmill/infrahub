# yaml-language-server: $schema=https://schema.infrahub.app/develop/schema.schema.json
---
version: '1.0'
generics:
  - name: interface
    kind: Interface
    display_labels:
      - name__value
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: speed
        kind: Number
      - name: mtu
        label: MTU
        default_value: 1500
        kind: Number
      - name: enabled
        kind: Boolean
        default_value: true
    relationships:
      - name: status
        peer: Status
        optional: false
        cardinality: one
        kind: Attribute
      - name: role
        peer: Role
        optional: false
        cardinality: one
        kind: Attribute
      - name: device
        peer: Device
        identifier: "device__interface"
        optional: false
        cardinality: one
        kind: Parent
      - name: tags
        peer: Tag
        optional: true
        cardinality: many
        kind: Attribute
  - name: endpoint
    kind: Endpoint
    relationships:
      - name: connected_endpoint
        peer: Endpoint
        optional: true
        cardinality: one
        kind: Attribute
        identifier: connected__endpoint
nodes:
  - name: platform
    kind: Platform
    default_filter: name__value
    order_by:
      - name__value
    display_labels:
      - name__value
    attributes:
      - name: name
        kind: Text
        unique: true
      - name: description
        kind: Text
        optional: true
      - name: nornir_platform
        kind: Text
        optional: true
      - name: napalm_driver
        kind: Text
        optional: true
      - name: netmiko_device_type
        kind: Text
        optional: true
      - name: ansible_network_os
        kind: Text
        optional: true
    relationships:
      - name: devices
        peer: Device
        optional: true
        cardinality: many
        kind: Attribute
  - name: device
    kind: Device
    default_filter: name__value
    order_by:
      - name__value
    display_labels:
      - name__value
    attributes:
      - name: name
        kind: Text
        unique: true
      - name: description
        kind: Text
        optional: true
      - name: type
        kind: Text
    relationships:
      - name: site
        peer: Location
        optional: false
        cardinality: one
        kind: Attribute
      - name: status
        peer: Status
        optional: false
        cardinality: one
        kind: Attribute
      - name: role
        peer: Role
        optional: false
        cardinality: one
        kind: Attribute
      - name: interfaces
        peer: Interface
        identifier: "device__interface"
        optional: true
        cardinality: many
        kind: Component
      - name: asn
        peer: AutonomousSystem
        optional: true
        cardinality: one
        kind: Attribute
      - name: tags
        peer: Tag
        optional: true
        cardinality: many
        kind: Attribute
      - name: primary_address
        peer: IPAddress
        label: Primary IP Address
        optional: true
        cardinality: one
        kind: Attribute
      - name: platform
        peer: Platform
        optional: true
        cardinality: one
        kind: Attribute
  - name: interface_l3
    kind: InterfaceL3
    display_labels:
      - name__value
    order_by:
      - name__value
    inherit_from: ["Interface", "Endpoint"]
    relationships:
      - name: ip_addresses
        peer: IPAddress
        optional: true
        cardinality: many
        kind: Component
  - name: interface_l2
    kind: InterfaceL2
    display_labels:
      - name__value
    order_by:
      - name__value
    inherit_from: ["Interface", "Endpoint"]
    attributes:
      - name: l2_mode
        label: Layer2 Mode
        kind: Text
        enum: ["Access", "Trunk"]
    relationships:
      - name: untagged_vlan
        label: Untagged VLAN
        peer: VLAN
        optional: true
        cardinality: one
        kind: Component
        identifier: interface_l2__untagged_vlan
      - name: tagged_vlan
        label: Tagged VLANs
        peer: VLAN
        optional: true
        cardinality: one
        kind: Component
        identifier: interface_l2__tagged_vlan
  - name: ipaddress
    kind: IPAddress
    default_filter: address__value
    order_by:
      - "address__value"
    display_labels:
      - address__value
    attributes:
      - name: address
        kind: Text
      - name: description
        kind: Text
        optional: true
    relationships:
      - name: interface
        peer: InterfaceL3
        optional: true
        cardinality: one
        kind: Parent
  - name: vlan
    kind: VLAN
    default_filter: name__value
    order_by:
      - name__value
    display_labels:
      - name__value
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: vlan_id
        kind: Number
    relationships:
      - name: site
        peer: Location
        optional: true
        cardinality: one
        kind: Attribute
      - name: status
        peer: Status
        optional: false
        cardinality: one
        kind: Attribute
      - name: role
        peer: Role
        optional: false
        cardinality: one
        kind: Attribute
      - name: gateway
        label: L3 Gateway
        peer: InterfaceL3
        optional: true
        cardinality: one
        kind: Attribute
  - name: circuit
    kind: Circuit
    default_filter: circuit_id__value
    order_by:
      - circuit_id__value
    display_labels:
      - circuit_id__value
    attributes:
      - name: circuit_id
        kind: Text
        unique: true
      - name: description
        kind: Text
        optional: true
      - name: vendor_id
        kind: Text
        optional: true
    relationships:
      - name: status
        peer: Status
        optional: false
        cardinality: one
        kind: Attribute
      - name: role
        peer: Role
        optional: false
        cardinality: one
        kind: Attribute
      - name: provider
        peer: Organization
        optional: false
        cardinality: one
        kind: Attribute
      - name: endpoints
        peer: CircuitEndpoint
        optional: true
        cardinality: many
        kind: Component
  - name: circuit_endpoint
    kind: CircuitEndpoint
    attributes:
      - name: description
        kind: Text
        optional: true
    inherit_from: [Endpoint]
    relationships:
      - name: site
        peer: Location
        optional: false
        cardinality: one
        kind: Attribute
      - name: circuit
        peer: Circuit
        optional: false
        cardinality: one
        kind: Parent
  - name: autonomous_system
    kind: AutonomousSystem
    default_filter: name__value
    order_by: ["asn__value"]
    display_labels:
      - name__value
      - asn__value
    attributes:
      - name: name
        kind: Text
        unique: true
      - name: asn
        kind: Number
        unique: true
      - name: description
        kind: Text
        optional: true
    relationships:
      - name: organization
        peer: Organization
        optional: false
        cardinality: one
        kind: Attribute
  - name: bgp_peer_group
    kind: BGPPeerGroup
    default_filter: name__value
    order_by:
      - name__value
    display_labels:
      - name__value
    attributes:
      - name: name
        kind: Text
      - name: description
        kind: Text
        optional: true
      - name: import_policies
        kind: Text
        optional: true
      - name: export_policies
        kind: Text
        optional: true
    relationships:
      - name: local_as
        identifier: bgppeergroup__local_as
        peer: AutonomousSystem
        optional: true
        cardinality: one
        kind: Attribute
      - name: remote_as
        identifier: bgppeergroup__remote_as
        peer: AutonomousSystem
        optional: true
        cardinality: one
        kind: Attribute
  - name: bgp_session
    kind: BGPSession
    order_by:
      - device__name__value
      - remote_as__asn__value
    attributes:
      - name: type
        kind: Text
        enum: [EXTERNAL, INTERNAL]
      - name: description
        kind: Text
        optional: true
      - name: import_policies
        kind: Text
        optional: true
      - name: export_policies
        kind: Text
        optional: true
    relationships:
      - name: status
        peer: Status
        optional: false
        cardinality: one
        kind: Attribute
      - name: role
        peer: Role
        optional: false
        cardinality: one
        kind: Attribute
      - name: local_as
        identifier: bgpsession__local_as
        peer: AutonomousSystem
        optional: true
        cardinality: one
        kind: Attribute
      - name: remote_as
        identifier: bgpsession__remote_as
        peer: AutonomousSystem
        optional: true
        cardinality: one
        kind: Attribute
      - name: local_ip
        identifier: bgpsession__local_ip
        peer: IPAddress
        optional: true
        cardinality: one
        kind: Attribute
      - name: remote_ip
        identifier: bgpsession__remote_ip
        peer: IPAddress
        optional: true
        cardinality: one
        kind: Attribute
      - name: device
        peer: Device
        optional: true
        cardinality: one
      - name: peer_group
        peer: BGPPeerGroup
        optional: true
        cardinality: one
        kind: Attribute
      - name: peer_session
        peer: BGPSession
        optional: true
        cardinality: one
        kind: Attribute
