FROM python:3.11

RUN apt-get update \
    && apt-get install -y --no-install-recommends docker.io docker-compose \
    && rm -rf /var/lib/apt/lists/*

RUN usermod -aG docker vscode

WORKDIR /workspace

COPY . .

RUN pip install --no-cache-dir toml invoke

RUN curl -sSL https://install.python-poetry.org | python3 -
RUN poetry config virtualenvs.create false
RUN poetry install

ENV PATH=/usr/local/bin:$PATH

CMD ["poetry", "run", "invoke", "demo.destroy", "demo.init", "demo.start", "demo.load-infra-schema", "demo.load-infra-data"]
